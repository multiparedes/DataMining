---
title: "Assignment 2 - Regression"
author: "Marti Pardes Salom"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
---

## Introduction

In this second assignment of Data mining we will be using the Prestige dataframe that comes with the `car` package, with this data we will try to make regression model where icome will be the dependent variable. First of all we will import the library so we can take a look at what data contains Prestige.

```{r}
library(car)
prestige <- Prestige
summary(prestige)
```

The Prestige data frame has 102 rows and 6 columns where the observations are occupations, from the 6 columns we will focus only in 2: education, that contains the average education of occupational incumbents in years and income, the average income of incumbents in dolas dollars.

We will create a new dataframe with only this two columns to make our work easier

```{r}
df <- prestige[, c("education", "income")]
str(df)
```

We can observ that the education columns is of type Number(double) that makes sense with what we just researched, and the income is of type Int.

The last thing we need to do before doing the data analysis is to check if the columns have any NANs.

```{r}
columns_with_nan <- colSums(is.na(df))
columns_with_nan
```

As we can observe the data don't have any missing values that we need to take care of.

## Data Analysis

Now that we have a ready dataframe we are going to take more indeepth look at the data, how is their distribution, how much are they correlated, there are any otliers? etc

First of all we will draw a histogram for income and a boxplot for education.

```{r}
par(mfrow = c(1, 2))

hist(df$income, main = "Histogram for Income variable", xlab = "Income (In dolas)", col = "lightblue")
boxplot(df$education, main = "Boxplot for Eduacation variable", ylab = "Education (In years)", col = "lightblue")
```

Upon examination, it becomes apparent that the 'income' data exhibits outliers
beyond the threshold of 25000. We will address these outliers shortly. In contrast,
the 'education' column demonstrates a more balanced distribution, spanning values 
from 6 to 16, with a well-centered mean.

To deal with the outliers we are going to see what entries they are.

```{r}
potential_outliers <- df[df$income > 25000, ]
df <- df[df$income <= 25700, ]
# df <- df[df$income <= 25000, ]

print(potential_outliers)
```

As we can see we identify two instances with incomes exceeding $25,000. Notably, these cases are associated with higher education values. Given this context, we interpret these entries as potentially valid and choose not to treat them as outliers.

To wrap up the data exploration process, we aim to gain insights into the overall distribution of the dataset. To achieve this, a scatter plot will be generated using the GGally library. A scatter plot is a visual representation that allows us to observe the relationships and patterns between two variables simultaneously. In our case, it will provide a graphical depiction of how the data points are distributed concerning both income and education.

```{r}
library(ggplot2)
library(GGally)
ggpairs(data = df, mapping = aes(color = ""))   
```

TODO: Write about the scatterplot

## Regression Models



```{r}
regression <- lm( income ~ education, data=df_no_outliers )
print(summary(regression))
```
```{r}
plot(df_no_outliers$education, df_no_outliers$income, 
     main="Scatterplot with Regression Line",
     xlab="Education", ylab="Income", col="#FF5733", pch=16)
abline(regression, col="black", lwd=2)
```

```{r}
poly_model <- lm(income ~ poly(education, 2), data = df)
summary(poly_model)
```
```{r}
plot(df$education, df$income, 
     main="Scatterplot with Quadratic Regression Line",
     xlab="Education", ylab="Income", col="#FF5733", pch=16)

x_seq <- seq(min(df$education), max(df$education), length.out = 100)
y_pred <- predict(poly_model, newdata = data.frame(education = x_seq, education2 = x_seq^2))
lines(x_seq, y_pred, col="black", lwd=2)
```


```{r}
cubic_model <- lm(income ~ poly(education, 3), data = df)

plot(df$education, df$income, 
     main="Scatterplot with Cubic Regression Line",
     xlab="Education", ylab="Income", col="#FF5733", pch=16)

x_seq_3 <- seq(min(df$education), max(df$education), length.out = 100)
y_pred_3 <- predict(cubic_model, newdata = data.frame(education = x_seq))
lines(x_seq_3, y_pred_3, col="blue", lwd=2)
```

```{r}
plot(df$education, df$income, 
     main="Scatterplot with Regression Lines",
     xlab="Education", ylab="Income", col="#FF5733", pch=16)
abline(regression, col="black", lwd=2)
lines(x_seq, y_pred, col="green", lwd=2)
lines(x_seq_3, y_pred_3, col="blue", lwd=2)
legend("topleft", legend=c("Linear", "Quadratic", "Cubic"),
       col=c("black", "green", "blue"), lwd=2, pch=16)
```

```{r}
cat("Linear ->", summary(regression)$r.squared, "\n")
cat("Quadratic ->", summary( poly_model)$r.squared, "\n")
cat("Quadratic ->", summary(cubic_model)$r.squared, "\n")
```

## Data transformations

```{r}
df$log_income <- log(df$income)
df$log_education <- log(df$education)

par(mfrow = c(1, 3))

plot(df$education, df$log_income, 
     main="Scatterplot with Regression Lines",
     xlab="Education", ylab="Income", col="#FF5733", pch=16)

plot(df$log_education, df$income, 
     main="Scatterplot with Regression Lines",
     xlab="Education", ylab="Income", col="#FF5733", pch=16)

plot(df$log_education, df$log_income, 
     main="Scatterplot with Regression Lines",
     xlab="Education", ylab="Income", col="#FF5733", pch=16)
```

```{r}
loglog <- lm( log_income ~ log_education, data=df )
plot(df$log_education, df$log_income, 
     main="Scatterplot with Regression Lines",
     xlab="Education", ylab="Income", col="#FF5733", pch=16)
abline(loglog, col="black", lwd=2)

summary(loglog)
```

